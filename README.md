# C Implementation of Blockchain Commons Uniform Resources

## Overview

This project aims to provide a lightweight, high-performance C implementation of the [Blockchain Commons Uniform Resources (UR)](https://github.com/BlockchainCommons/Research/blob/master/papers/bcr-2020-005-ur.md) specification. URs are a method for encoding structured binary data in a format optimized for transport via QR codes and other data channels.

## MicroPython Integration

This library can be integrated directly into C applications. For MicroPython-based embedded applications, integration is possible through a C wrapper module like the `uUR.c` example.

## Reference Implementation

This implementation uses [foundation-ur-py](https://github.com/Foundation-Devices/foundation-ur-py) as a reference implementation for testing and validation. The Python library is included as a Git submodule and serves as a known-good implementation for cross-compatibility testing between the C encoder and decoder.

## License

This project is licensed under the **BSD-2-Clause Plus Patent License**.

Copyright © 2025 Krux Contributors

This is an independent implementation written using foundation-ur-py as a reference for testing and validation. The implementation follows the Blockchain Commons UR specification but does not derive from their codebase.

See the [LICENSE](LICENSE) file for full license text.

## Building

Build the UR library:

```bash
make clean && make all
```

This creates `src/libur.a` with both UREncoder and URDecoder implementations.

## Testing

All test files are organized in the `tests/` directory.

### URDecoder Tests

Test the decoder with pre-generated UR fragments:

```bash
make test-decoder
```

This runs `tests/test_ur_decoder` which:
- Reads UR fragments from `tests/test_cases/*.UR_fragments.txt`
- Decodes them with URDecoder
- Verifies against original CBOR data in `tests/test_cases/*.UR_object.txt`

Run decoder test for a specific test case:

```bash
./tests/test_ur_decoder tests/test_cases/data_1.UR_fragments.txt
```

### UREncoder Tests

Test the encoder with encode/decode roundtrip verification:

```bash
make test-encoder
```

This runs `tests/test_ur_encoder` which:
- Reads CBOR data from `tests/test_cases/*.UR_object.txt`
- Encodes with UREncoder to generate UR fragments
- Decodes fragments with URDecoder
- Verifies perfect roundtrip (original data matches decoded data)

### Cross-Implementation Tests

Test compatibility between C encoder and Python decoder:

```bash
bash tests/test_cross_implementation.sh
```

This test verifies that fragments generated by the C encoder can be successfully decoded by the reference Python decoder implementation. For each test case, it:
1. Generates UR fragments using the C encoder (`tests/test_print_fragments`)
2. Decodes fragments using the Python decoder (from `foundation-ur-py`)
3. Verifies decoded data matches the original CBOR data

The script tests all 5 test cases individually and reports:
- Fragment count and encoding parameters for each test
- Decoding success and data verification results
- Summary with pass/fail counts

**Prerequisites:** Ensure the Python reference implementation is available at `foundation-ur-py/` (submodule).

### Test Results

All test suites pass with 100% success rate on all 5 test cases:
- ✅ URDecoder: 5/5 tests passing
- ✅ UREncoder: 5/5 tests passing (encode → decode roundtrip verified)
- ✅ Cross-implementation: 5/5 tests passing (C encoder → Python decoder verified)